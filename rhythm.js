function percToN(percentage, n) {
  return (percentage / 100) * n;
}

async function RhythmFunc() {
  var b1,b2,b3,b4,b5,b6,b7,b8,b9,b10,b11,b12;
  document.getElementById("audioHahaha").play(); // Play music

  await sleep(2830);
  b1 = openWindow('assets/faces/white.html', percToN(50, screenWidth), percToN(50, screenHeight));
  await sleep(350);
  b2 = openWindow('assets/faces/white.html', percToN(0, screenWidth), percToN(100, screenHeight));
  await sleep(350);
  b3 = openWindow('assets/faces/white.html', percToN(100, screenWidth), percToN(0, screenHeight));
  await sleep(350);
  b4 = openWindow('assets/faces/white.html', percToN(0, screenWidth), percToN(0, screenHeight));
  await sleep(350);
  b5 = openWindow('assets/faces/white.html', percToN(100, screenWidth), percToN(100, screenHeight));
  await sleep(350);
  b5.close();
  await sleep(350);
  b4.close();
  await sleep(350);
  b3.close();
  await sleep(175);
  b2.close();
  await sleep(175);
  b1.close();
  b1 = openWindow('assets/faces/white.html', percToN(50, screenWidth) - 50, percToN(50, screenHeight) - 50, 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/white.html', percToN(50, screenWidth) - 100, percToN(50, screenHeight) - 100, 400, 400);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/black.html', percToN(50, screenWidth) - 50, percToN(50, screenHeight) - 50, 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/black.html', percToN(50, screenWidth) - 100, percToN(50, screenHeight) - 100, 400, 400);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/white.html', percToN(50, screenWidth) - 50, percToN(50, screenHeight) - 50, 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/white.html', percToN(50, screenWidth) - 100, percToN(50, screenHeight) - 100, 400, 400);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/white.html', percToN(50, screenWidth) - 50, percToN(50, screenHeight) - 50, 300, 300);
  
  await sleep(175);
  b1.close();
  b1 = openWindow('assets/faces/white.html', percToN(10, screenWidth), percToN(15, screenHeight));
  await sleep(50);
  b2 = openWindow('assets/faces/white.html', percToN(30, screenWidth), percToN(15, screenHeight), 216, 216);
  await sleep(50);
  b3 = openWindow('assets/faces/white.html', percToN(50, screenWidth), percToN(15, screenHeight), 240, 240);
  await sleep(50);
  b4 = openWindow('assets/faces/white.html', percToN(70, screenWidth), percToN(15, screenHeight), 260, 260);
  await sleep(50);
  b5 = openWindow('assets/faces/white.html', percToN(90, screenWidth), percToN(27, screenHeight), 280, 280);
  await sleep(50);
  b6 = openWindow('assets/faces/white.html', percToN(60, screenWidth), percToN(43, screenHeight), 300, 300);
  await sleep(50);
  b7 = openWindow('assets/faces/white.html', percToN(40, screenWidth), percToN(71, screenHeight), 316, 316);
  await sleep(50);
  b8 = openWindow('assets/faces/white.html', percToN(0, screenWidth), percToN(100, screenHeight), 332, 332);
  await sleep(50);
  b9 = openWindow('assets/faces/white.html', percToN(20, screenWidth), percToN(50, screenHeight), 348, 348);
  await sleep(50);
  b10 = openWindow('assets/faces/white.html', percToN(30, screenWidth), percToN(8,  screenHeight), 364, 364);
  await sleep(50);
  b11 = openWindow('assets/faces/white.html', percToN(50, screenWidth), percToN(5,  screenHeight), 380, 380);
  await sleep(50);
  b12 = openWindow('assets/faces/white.html', percToN(25, screenWidth), percToN(12, screenHeight), 400, 400);
  await sleep(350);
  b12.close();
  await sleep(350);
  b11.close();
  await sleep(350);
  b10.close();
  await sleep(350);
  b9.close();
  await sleep(350);
  b8.close();
  await sleep(350);
  b7.close();
  await sleep(350);
  b6.close();
  await sleep(150);
  b5.close();
  await sleep(150);
  b4.close();
  await sleep(150);
  b3.postMessage([percToN(25, screenWidth), percToN(50, screenHeight), 2500], '*');
  b2.postMessage([percToN(50, screenWidth), percToN(50, screenHeight), 2500], '*');
  b1.postMessage([percToN(75, screenWidth), percToN(50, screenHeight), 2500], '*');
  
  await sleep(2500);
  b1.close();
  b2.close();
  b3.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(15, screenWidth), percToN(85, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(50, screenWidth), percToN(50, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(85, screenWidth), percToN(15, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(15, screenWidth), percToN(15, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(50, screenWidth), percToN(50, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(85, screenWidth), percToN(85, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(15, screenWidth), percToN(50, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(85, screenWidth), percToN(15, screenHeight), 300, 300);
  await sleep(150);
  b2 = openWindow('assets/faces/pulse.html', percToN(15, screenWidth), percToN(85, screenHeight), 300, 300);
  await sleep(150);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(50, screenWidth), percToN(50, screenHeight), 300, 300);
  await sleep(150);
  b2.close();
  await sleep(150);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(15, screenWidth), percToN(15, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(85, screenWidth), percToN(85, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(15, screenWidth), percToN(50, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(75, screenWidth), percToN(15, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(50, screenWidth), percToN(85, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
  b1 = openWindow('assets/faces/pulse.html', percToN(50, screenWidth), percToN(15, screenHeight), 300, 300);
  await sleep(350);
  b1.close();
}

var lastSleep = 0;
function sleep(ms) {
  if (lastSleep == 0) lastSleep = Date.now();
  return new Promise(resolve => setTimeout(() => { lastSleep += ms; resolve(); }, Math.max(lastSleep + ms - Date.now(), 0)));
}
